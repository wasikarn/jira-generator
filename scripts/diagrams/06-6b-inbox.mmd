flowchart TD
    EV["Pusher event arrives<br/>{event_id, version}"] e2@--> CHK{"Duplicate?<br/>event_id seen?<br/>version â‰¤ local?"}
    CHK e3@-->|"YES"| SKIP["SKIP"]
    CHK e4@-->|"NO"| PROC["PROCESS<br/>fetch schedule<br/>update cache<br/>store event_id"]
    REC["On reconnect"] e1@--> FETCH["GET /v2/screen-schedule<br/>?since_version=N"]
    FETCH e5@--> DELTA["Delta or full<br/>(if gap > 3)"]
    e1@{ animation: slow }
    e2@{ animation: fast }
    e3@{ animation: fast }
    e4@{ animation: fast }
    e5@{ animation: fast }
    style EV fill:#cce5ff,stroke:#004085
    style CHK fill:#fff3cd,stroke:#ffc107
    style SKIP fill:#f8d7da,stroke:#dc3545
    style PROC fill:#d4edda,stroke:#28a745
    style REC fill:#cce5ff,stroke:#004085
    style DELTA fill:#d4edda,stroke:#28a745
