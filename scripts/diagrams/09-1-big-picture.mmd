flowchart LR

    subgraph SCHED["Scheduling"]
        direction LR
        A_CRON(["Cron<br/>System"])
        C_CALC["Calculate<br/>Schedule"]
        AGG_PS["PlaySchedule"]
        E_CALCULATED["Schedule<br/>Calculated"]
        POL_BUILD{{"Build Screen<br/>Schedule"}}
        AGG_ADE["Ad Decisioning<br/>Engine"]
        E_BUILT["Screen Schedule<br/>Built"]
        POL_PUSH{{"Push to<br/>Player"}}
        EXT_PUSHER[("Pusher")]

        A_CRON e4@--> C_CALC
        C_CALC e5@--> AGG_PS
        AGG_PS e6@--> E_CALCULATED
        E_CALCULATED e7@--> POL_BUILD
        POL_BUILD e8@--> AGG_ADE
        AGG_ADE e9@--> E_BUILT
        E_BUILT e10@--> POL_PUSH
        POL_PUSH e11@--> EXT_PUSHER
    end

    subgraph PLAY["Playback"]
        direction LR
        E_RECEIVED["Schedule<br/>Received"]
        C_FETCH["Fetch<br/>Schedule"]
        AGG_CACHE["3-Tier<br/>Cache"]
        E_CACHED["Cache<br/>Updated"]
        POL_PLAY{{"Play<br/>Sequence"}}
        E_PLAYED["Creative<br/>Played"]
        C_RECORD["Record<br/>PoP"]
        AGG_OUTBOX["PoP<br/>Outbox"]
        E_POP["PoP<br/>Recorded"]
        POL_FLUSH{{"Flush to<br/>Backend"}}

        E_RECEIVED e12@--> C_FETCH
        C_FETCH e13@--> AGG_CACHE
        AGG_CACHE e14@--> E_CACHED
        E_CACHED e15@--> POL_PLAY
        POL_PLAY e16@--> E_PLAYED
        E_PLAYED e17@--> C_RECORD
        C_RECORD e18@--> AGG_OUTBOX
        AGG_OUTBOX e19@--> E_POP
        E_POP e20@--> POL_FLUSH
    end

    subgraph INTPT["Interrupt"]
        direction LR
        A_ADMIN(["Admin<br/>Human"])
        C_APPROVE["Approve<br/>Takeover"]
        AGG_TK["Takeover<br/>Schedule"]
        E_TK_APPROVED["Takeover<br/>Approved"]
        POL_INTERRUPT{{"Interrupt<br/>Current Ad"}}
        E_INTERRUPTED["Ad<br/>Interrupted"]
        POL_MAKEGOOD{{"Schedule<br/>Make-Good"}}
        AGG_MG["MakeGood<br/>Record"]
        E_MG["Make-Good<br/>Scheduled"]

        A_ADMIN e21@--> C_APPROVE
        C_APPROVE e22@--> AGG_TK
        AGG_TK e23@--> E_TK_APPROVED
        E_TK_APPROVED e24@--> POL_INTERRUPT
        POL_INTERRUPT e25@--> E_INTERRUPTED
        E_INTERRUPTED e26@--> POL_MAKEGOOD
        POL_MAKEGOOD e27@--> AGG_MG
        AGG_MG e28@--> E_MG
    end

    subgraph DEVICE["Device Lifecycle"]
        direction LR
        E_PAIRED["Screen<br/>Paired"]
        E_BOOTED["Device<br/>Booted"]
        E_SYNCED["Device<br/>Resynced"]
        E_UNPAIRED["Screen<br/>Unpaired"]

        E_PAIRED e29@--> E_BOOTED
        E_BOOTED e30@--> E_SYNCED
        E_SYNCED e31@--> E_UNPAIRED
    end

    EXT_PUSHER e1@-.-> E_RECEIVED
    POL_FLUSH e2@-.-> EXT_API[("Backend<br/>API")]
    POL_INTERRUPT e3@-.-> E_RECEIVED
    e1@{ animation: slow }
    e2@{ animation: slow }
    e3@{ animation: slow }
    e4@{ animation: fast }
    e5@{ animation: fast }
    e6@{ animation: fast }
    e7@{ animation: fast }
    e8@{ animation: fast }
    e9@{ animation: fast }
    e10@{ animation: fast }
    e11@{ animation: slow }
    e12@{ animation: fast }
    e13@{ animation: fast }
    e14@{ animation: fast }
    e15@{ animation: fast }
    e16@{ animation: fast }
    e17@{ animation: fast }
    e18@{ animation: fast }
    e19@{ animation: fast }
    e20@{ animation: fast }
    e21@{ animation: fast }
    e22@{ animation: fast }
    e23@{ animation: fast }
    e24@{ animation: fast }
    e25@{ animation: fast }
    e26@{ animation: fast }
    e27@{ animation: fast }
    e28@{ animation: fast }
    e29@{ animation: fast }
    e30@{ animation: fast }
    e31@{ animation: fast }
