flowchart TD
    A_CRON(["Cron<br/>every 10 min"])
    C_CALC["CalculateSchedule"]
    AGG_PS["PlaySchedule"]
    E_CALCULATED["ScheduleCalculated"]
    RM_CAMPAIGNS[/"Active Campaigns<br/>+ SOV Ratios"/]
    POL_BUILD{{"Whenever ScheduleCalculated<br/>then BuildScreenSchedule"}}
    C_BUILD["BuildScreenSchedule"]
    AGG_ADE["AdDecisioningService"]
    RM_PRIORITY[/"Priority Rules<br/>P1-G > P2 > P3 > P4"/]
    AGG_SS["ScreenSchedule"]
    E_BUILT["ScreenScheduleBuilt"]
    POL_PUSH{{"Whenever ScreenScheduleBuilt<br/>then Push via Pusher"}}
    C_PUSH["PushScheduleUpdate"]
    EXT_PUSHER[("Pusher<br/>WebSocket")]
    E_PUSHED["SchedulePushed"]

    A_CRON e2@--> C_CALC
    C_CALC e3@--> AGG_PS
    AGG_PS e4@--> E_CALCULATED
    RM_CAMPAIGNS e5@-.-> C_BUILD
    E_CALCULATED e6@--> POL_BUILD
    POL_BUILD e7@--> C_BUILD
    C_BUILD e8@--> AGG_ADE
    RM_PRIORITY e9@-.-> AGG_ADE
    AGG_ADE e10@--> AGG_SS
    AGG_SS e11@--> E_BUILT
    E_BUILT e12@--> POL_PUSH
    POL_PUSH e13@--> C_PUSH
    C_PUSH e1@--> EXT_PUSHER
    EXT_PUSHER e14@--> E_PUSHED
    e1@{ animation: slow }
    e2@{ animation: fast }
    e3@{ animation: fast }
    e4@{ animation: fast }
    e5@{ animation: fast }
    e6@{ animation: fast }
    e7@{ animation: fast }
    e8@{ animation: fast }
    e9@{ animation: fast }
    e10@{ animation: fast }
    e11@{ animation: fast }
    e12@{ animation: fast }
    e13@{ animation: fast }
    e14@{ animation: slow }

    %% Events - Orange
    style E_CALCULATED fill:#FF8C00,stroke:#CC7000,color:#fff
    style E_BUILT fill:#FF8C00,stroke:#CC7000,color:#fff
    style E_PUSHED fill:#FF8C00,stroke:#CC7000,color:#fff

    %% Commands - Blue
    style C_CALC fill:#4169E1,stroke:#2850B0,color:#fff
    style C_BUILD fill:#4169E1,stroke:#2850B0,color:#fff
    style C_PUSH fill:#4169E1,stroke:#2850B0,color:#fff

    %% Aggregates - Yellow
    style AGG_PS fill:#FFD700,stroke:#CCB000,color:#333
    style AGG_ADE fill:#FFD700,stroke:#CCB000,color:#333
    style AGG_SS fill:#FFD700,stroke:#CCB000,color:#333

    %% Policies - Lilac
    style POL_BUILD fill:#C8A2C8,stroke:#9B7A9B,color:#333
    style POL_PUSH fill:#C8A2C8,stroke:#9B7A9B,color:#333

    %% Actor - Light Yellow
    style A_CRON fill:#FFFACD,stroke:#CCC88A,color:#333

    %% Read Models - Green
    style RM_CAMPAIGNS fill:#90EE90,stroke:#6BBE6B,color:#333
    style RM_PRIORITY fill:#90EE90,stroke:#6BBE6B,color:#333

    %% External - Pink
    style EXT_PUSHER fill:#FFB6C1,stroke:#CC929A,color:#333
