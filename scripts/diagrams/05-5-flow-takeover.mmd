sequenceDiagram
    participant OW as Billboard Owner
    participant BE as Backend
    participant PU as Pusher
    participant PL as Player
    OW->>BE: Book Daypart Takeover<br/>(08:00-09:00, creative CR-xxx)
    rect rgb(240, 240, 240)
        Note over BE: Validate: no overlap (checkIsBillboardsReserved)<br/>Validate: creative exists + checksum OK<br/>Create TakeoverSchedule (status=booked)
    end
    BE->>BE: Ad Decisioning v3: reserve TK block<br/>+ pre-stage in Tier 2
    BE->>PU: device-config-updated {takeover_id, creative_code}
    PU->>PL: Pre-download TK creative
    rect rgb(255, 247, 200)
        Note over BE,PL: 08:00 — TK_START
        BE->>PU: takeover-start {takeover_id, version, end_time}
        PU->>PL: Interrupt Controller: stop current creative
        Note over PL: Switch to TK creative<br/>Loop: play 30s → repeat<br/>No other ads (P2-P4 blocked)
    end
    rect rgb(200, 230, 255)
        Note over PL: During TK: PoP reports<br/>interrupted=true for stopped ad<br/>make_good=false (pending)
        PL->>BE: POST /v2/proof-of-play<br/>{interrupted: true, interrupt_reason: "TK_start"}
    end
    rect rgb(255, 247, 200)
        Note over BE,PL: 09:00 — TK_END
        BE->>PU: takeover-end {takeover_id, version}
        PU->>PL: Interrupt Controller: resume normal schedule
    end
    Note over PL: Resume from NEXT item in schedule<br/>(interrupted ad gets make-good slot)
    BE->>BE: MakeGoodRecord: schedule compensation<br/>for interrupted ad in next cycle
